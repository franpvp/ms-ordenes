databaseChangeLog:
  - changeSet:
      id: 1-create-core-tables
      author: fran
      changes:
        # ========== TIPO_USUARIO ==========
        - createTable:
            tableName: TIPO_USUARIO
            columns:
              - column:
                  name: id_tipo_usuario
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: nombre_tipo
                  type: VARCHAR(50)
                  constraints:
                    nullable: false
              - column:
                  name: descripcion
                  type: VARCHAR(255)

        # ========== USUARIO ==========
        - createTable:
            tableName: USUARIO
            columns:
              - column:
                  name: id_usuario
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: id_tipo_usuario
                  type: BIGINT
                  constraints:
                    nullable: false
              - column:
                  name: username
                  type: VARCHAR(100)
                  constraints:
                    nullable: false
                    unique: true
              - column:
                  name: password_hash
                  type: VARCHAR(255)
                  constraints:
                    nullable: false
              - column:
                  name: email
                  type: VARCHAR(150)
                  constraints:
                    nullable: false
                    unique: true
              - column:
                  name: activo
                  type: NUMBER(1)
                  constraints:
                    nullable: false
              - column:
                  name: fecha_creacion
                  type: TIMESTAMP WITH TIME ZONE
                  constraints:
                    nullable: false

        # ========== CLIENTE ==========
        - createTable:
            tableName: CLIENTE
            columns:
              - column:
                  name: id_cliente
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: id_usuario
                  type: BIGINT
                  constraints:
                    nullable: false
              - column:
                  name: nombre
                  type: VARCHAR(100)
                  constraints:
                    nullable: false
              - column:
                  name: apellido
                  type: VARCHAR(100)
                  constraints:
                    nullable: false
              - column:
                  name: telefono
                  type: VARCHAR(30)
              - column:
                  name: direccion
                  type: VARCHAR(255)
              - column:
                  name: ciudad
                  type: VARCHAR(100)
              - column:
                  name: fecha_registro
                  type: DATE

        # ========== ESTADO_CARRITO ==========
        - createTable:
            tableName: ESTADO_CARRITO
            columns:
              - column:
                  name: id_estado_carrito
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: estado_carrito
                  type: VARCHAR(30)
                  constraints:
                    nullable: false

        # ========== CARRITO ==========
        - createTable:
            tableName: CARRITO
            columns:
              - column:
                  name: id_carrito
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: id_cliente
                  type: BIGINT
                  constraints:
                    nullable: false
              - column:
                  name: id_estado_carrito
                  type: BIGINT
                  constraints:
                    nullable: false
              - column:
                  name: fecha_creacion
                  type: TIMESTAMP WITH TIME ZONE
                  constraints:
                    nullable: false
              - column:
                  name: total
                  type: NUMBER(18,2)
                  constraints:
                    nullable: false

        # ========== CATEGORIA ==========
        - createTable:
            tableName: CATEGORIA
            columns:
              - column:
                  name: id_categoria
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: nombre_categoria
                  type: VARCHAR(100)
                  constraints:
                    nullable: false
              - column:
                  name: descripcion
                  type: VARCHAR(255)

        # ========== PRODUCTO ==========
        - createTable:
            tableName: PRODUCTO
            columns:
              - column:
                  name: id_producto
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: id_categoria
                  type: BIGINT
                  constraints:
                    nullable: false
              - column:
                  name: nombre
                  type: VARCHAR(150)
                  constraints:
                    nullable: false
              - column:
                  name: descripcion
                  type: VARCHAR(255)
              - column:
                  name: marca
                  type: VARCHAR(100)
              - column:
                  name: precio_unitario
                  type: NUMBER(18,2)
                  constraints:
                    nullable: false
              - column:
                  name: image_key
                  type: VARCHAR(255)

        # ========== INVENTARIO ==========
        - createTable:
            tableName: INVENTARIO
            columns:
              - column:
                  name: id_producto
                  type: BIGINT
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: cantidad_stock
                  type: NUMBER(10)
                  constraints:
                    nullable: false

        # ========== DETALLE_CARRITO ==========
        - createTable:
            tableName: DETALLE_CARRITO
            columns:
              - column:
                  name: id_detalle_carrito
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: id_carrito
                  type: BIGINT
                  constraints:
                    nullable: false
              - column:
                  name: id_producto
                  type: BIGINT
                  constraints:
                    nullable: false
              - column:
                  name: cantidad
                  type: NUMBER(10)
                  constraints:
                    nullable: false
              - column:
                  name: subtotal
                  type: NUMBER(18,2)
                  constraints:
                    nullable: false

        # ========== ORDEN ==========
        - createTable:
            tableName: ORDEN
            columns:
              - column:
                  name: id_orden
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: id_carrito
                  type: BIGINT
                  constraints:
                    nullable: false
              - column:
                  name: fecha_orden
                  type: TIMESTAMP WITH TIME ZONE
                  constraints:
                    nullable: false
              - column:
                  name: estado_orden
                  type: VARCHAR(30)
                  constraints:
                    nullable: false

        # ========== METODO_PAGO ==========
        - createTable:
            tableName: METODO_PAGO
            columns:
              - column:
                  name: id_metodo_pago
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: tipo_metodo_pago
                  type: VARCHAR(50)
                  constraints:
                    nullable: false

        # ========== ESTADO_PAGO ==========
        - createTable:
            tableName: ESTADO_PAGO
            columns:
              - column:
                  name: id_estado_pago
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: estado_pago
                  type: VARCHAR(30)
                  constraints:
                    nullable: false

        # ========== PAGO ==========
        - createTable:
            tableName: PAGO
            columns:
              - column:
                  name: id_pago
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: id_orden
                  type: BIGINT
                  constraints:
                    nullable: false
              - column:
                  name: id_metodo_pago
                  type: BIGINT
                  constraints:
                    nullable: false
              - column:
                  name: id_estado_pago
                  type: BIGINT
                  constraints:
                    nullable: false
              - column:
                  name: monto
                  type: NUMBER(18,2)
                  constraints:
                    nullable: false
              - column:
                  name: fecha_pago
                  type: TIMESTAMP WITH TIME ZONE
                  constraints:
                    nullable: false

        # ========== REINTENTO_PAGO ==========
        - createTable:
            tableName: REINTENTO_PAGO
            columns:
              - column:
                  name: id_reintento
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: id_pago
                  type: BIGINT
                  constraints:
                    nullable: false
              - column:
                  name: intento_numero
                  type: NUMBER(10)
                  constraints:
                    nullable: false
              - column:
                  name: estado_reintento
                  type: VARCHAR(30)
                  constraints:
                    nullable: false
              - column:
                  name: fecha_reintento
                  type: TIMESTAMP WITH TIME ZONE
                  constraints:
                    nullable: false

  - changeSet:
      id: 2-add-foreign-keys
      author: fran
      changes:
        - addForeignKeyConstraint:
            baseTableName: USUARIO
            baseColumnNames: id_tipo_usuario
            referencedTableName: TIPO_USUARIO
            referencedColumnNames: id_tipo_usuario
            constraintName: fk_usuario_tipo_usuario

        - addForeignKeyConstraint:
            baseTableName: CLIENTE
            baseColumnNames: id_usuario
            referencedTableName: USUARIO
            referencedColumnNames: id_usuario
            constraintName: fk_cliente_usuario

        - addForeignKeyConstraint:
            baseTableName: CARRITO
            baseColumnNames: id_cliente
            referencedTableName: CLIENTE
            referencedColumnNames: id_cliente
            constraintName: fk_carrito_cliente

        - addForeignKeyConstraint:
            baseTableName: CARRITO
            baseColumnNames: id_estado_carrito
            referencedTableName: ESTADO_CARRITO
            referencedColumnNames: id_estado_carrito
            constraintName: fk_carrito_estado

        - addForeignKeyConstraint:
            baseTableName: PRODUCTO
            baseColumnNames: id_categoria
            referencedTableName: CATEGORIA
            referencedColumnNames: id_categoria
            constraintName: fk_producto_categoria

        - addForeignKeyConstraint:
            baseTableName: INVENTARIO
            baseColumnNames: id_producto
            referencedTableName: PRODUCTO
            referencedColumnNames: id_producto
            constraintName: fk_inventario_producto

        - addForeignKeyConstraint:
            baseTableName: DETALLE_CARRITO
            baseColumnNames: id_carrito
            referencedTableName: CARRITO
            referencedColumnNames: id_carrito
            constraintName: fk_detalle_carrito_carrito

        - addForeignKeyConstraint:
            baseTableName: DETALLE_CARRITO
            baseColumnNames: id_producto
            referencedTableName: PRODUCTO
            referencedColumnNames: id_producto
            constraintName: fk_detalle_carrito_producto

        - addForeignKeyConstraint:
            baseTableName: ORDEN
            baseColumnNames: id_carrito
            referencedTableName: CARRITO
            referencedColumnNames: id_carrito
            constraintName: fk_orden_carrito

        - addForeignKeyConstraint:
            baseTableName: PAGO
            baseColumnNames: id_orden
            referencedTableName: ORDEN
            referencedColumnNames: id_orden
            constraintName: fk_pago_orden

        - addForeignKeyConstraint:
            baseTableName: PAGO
            baseColumnNames: id_metodo_pago
            referencedTableName: METODO_PAGO
            referencedColumnNames: id_metodo_pago
            constraintName: fk_pago_metodo

        - addForeignKeyConstraint:
            baseTableName: PAGO
            baseColumnNames: id_estado_pago
            referencedTableName: ESTADO_PAGO
            referencedColumnNames: id_estado_pago
            constraintName: fk_pago_estado

        - addForeignKeyConstraint:
            baseTableName: REINTENTO_PAGO
            baseColumnNames: id_pago
            referencedTableName: PAGO
            referencedColumnNames: id_pago
            constraintName: fk_reintento_pago_pago

  - changeSet:
      id: 3-insert-reference-data
      author: fran
      changes:
        # ========= TIPO_USUARIO =========
        - insert:
            tableName: TIPO_USUARIO
            columns:
              - column: { name: id_tipo_usuario, valueNumeric: 1 }
              - column: { name: nombre_tipo, value: "ADMIN" }
              - column: { name: descripcion, value: "Administrador del sistema" }

        - insert:
            tableName: TIPO_USUARIO
            columns:
              - column: { name: id_tipo_usuario, valueNumeric: 2 }
              - column: { name: nombre_tipo, value: "CLIENTE" }
              - column: { name: descripcion, value: "Cliente final e-commerce" }

        # ========= USUARIO =========
        - insert:
            tableName: USUARIO
            columns:
              - column: { name: id_usuario, valueNumeric: 1 }
              - column: { name: id_tipo_usuario, valueNumeric: 1 }
              - column: { name: username, value: "admin" }
              - column: { name: password_hash, value: "admin123" }
              - column: { name: email, value: "admin@techfactory.cl" }
              - column: { name: activo, valueNumeric: 1 }
              - column: { name: fecha_creacion, valueDate: "2025-01-01T10:00:00Z" }

        - insert:
            tableName: USUARIO
            columns:
              - column: { name: id_usuario, valueNumeric: 2 }
              - column: { name: id_tipo_usuario, valueNumeric: 2 }
              - column: { name: username, value: "fran" }
              - column: { name: password_hash, value: "fran123" }
              - column: { name: email, value: "fran@cliente.cl" }
              - column: { name: activo, valueNumeric: 1 }
              - column: { name: fecha_creacion, valueDate: "2025-01-02T12:00:00Z" }

        - insert:
            tableName: USUARIO
            columns:
              - column: { name: id_usuario, valueNumeric: 3 }
              - column: { name: id_tipo_usuario, valueNumeric: 2 }
              - column: { name: username, value: "belen" }
              - column: { name: password_hash, value: "belen123" }
              - column: { name: email, value: "belen@cliente.cl" }
              - column: { name: activo, valueNumeric: 1 }
              - column: { name: fecha_creacion, valueDate: "2025-01-03T09:30:00Z" }

        # ========= CLIENTE =========
        - insert:
            tableName: CLIENTE
            columns:
              - column: { name: id_cliente, valueNumeric: 1 }
              - column: { name: id_usuario, valueNumeric: 2 }
              - column: { name: nombre, value: "Francisca" }
              - column: { name: apellido, value: "Valdivia" }
              - column: { name: telefono, value: "+56911111111" }
              - column: { name: direccion, value: "Calle Tech 123" }
              - column: { name: ciudad, value: "Santiago" }
              - column: { name: fecha_registro, valueDate: "2025-01-05" }

        - insert:
            tableName: CLIENTE
            columns:
              - column: { name: id_cliente, valueNumeric: 2 }
              - column: { name: id_usuario, valueNumeric: 3 }
              - column: { name: nombre, value: "Belen" }
              - column: { name: apellido, value: "Palma" }
              - column: { name: telefono, value: "+56922222222" }
              - column: { name: direccion, value: "Calle Gamer 456" }
              - column: { name: ciudad, value: "Santiago" }
              - column: { name: fecha_registro, valueDate: "2025-01-06" }

        # ========= ESTADO_CARRITO =========
        - insert:
            tableName: ESTADO_CARRITO
            columns:
              - column: { name: id_estado_carrito, valueNumeric: 1 }
              - column: { name: estado_carrito, value: "ACTIVO" }

        - insert:
            tableName: ESTADO_CARRITO
            columns:
              - column: { name: id_estado_carrito, valueNumeric: 2 }
              - column: { name: estado_carrito, value: "ABANDONADO" }

        - insert:
            tableName: ESTADO_CARRITO
            columns:
              - column: { name: id_estado_carrito, valueNumeric: 3 }
              - column: { name: estado_carrito, value: "CONVERTIDO" }

        - insert:
            tableName: ESTADO_CARRITO
            columns:
              - column: { name: id_estado_carrito, valueNumeric: 4 }
              - column: { name: estado_carrito, value: "CERRADO" }

        # ========= CATEGORIA =========
        - insert:
            tableName: CATEGORIA
            columns:
              - column: { name: id_categoria, valueNumeric: 1 }
              - column: { name: nombre_categoria, value: "Teclados" }
              - column: { name: descripcion, value: "Teclados mecánicos, inalámbricos y más" }

        - insert:
            tableName: CATEGORIA
            columns:
              - column: { name: id_categoria, valueNumeric: 2 }
              - column: { name: nombre_categoria, value: "Mouses" }
              - column: { name: descripcion, value: "Mouses gamer y de oficina" }

        - insert:
            tableName: CATEGORIA
            columns:
              - column: { name: id_categoria, valueNumeric: 3 }
              - column: { name: nombre_categoria, value: "Monitores" }
              - column: { name: descripcion, value: "Monitores 2K/4K para trabajo y gaming" }

        - insert:
            tableName: CATEGORIA
            columns:
              - column: { name: id_categoria, valueNumeric: 4 }
              - column: { name: nombre_categoria, value: "Audio" }
              - column: { name: descripcion, value: "Audífonos y parlantes" }

        # ========= PRODUCTO =========
        - insert:
            tableName: PRODUCTO
            columns:
              - column: { name: id_producto, valueNumeric: 1 }
              - column: { name: id_categoria, valueNumeric: 2 }
              - column: { name: nombre, value: "Mouse Gamer RGB Pro" }
              - column: { name: descripcion, value: "Mouse gamer con 8 botones programables y RGB" }
              - column: { name: marca, value: "HyperTech" }
              - column: { name: precio_unitario, valueNumeric: 19990 }
              - column: { name: image_key, value: "images/mouse_gamer_1.png" }

        - insert:
            tableName: PRODUCTO
            columns:
              - column: { name: id_producto, valueNumeric: 2 }
              - column: { name: id_categoria, valueNumeric: 1 }
              - column: { name: nombre, value: "Teclado Mecánico Blue Switch" }
              - column: { name: descripcion, value: "Teclado mecánico con switches azules y retroiluminación" }
              - column: { name: marca, value: "KeyMaster" }
              - column: { name: precio_unitario, valueNumeric: 34990 }
              - column: { name: image_key, value: "images/teclado_mecanico_1.png" }

        - insert:
            tableName: PRODUCTO
            columns:
              - column: { name: id_producto, valueNumeric: 3 }
              - column: { name: id_categoria, valueNumeric: 3 }
              - column: { name: nombre, value: "Monitor 27 2K 165Hz" }
              - column: { name: descripcion, value: "Monitor gamer 2K 165Hz con FreeSync" }
              - column: { name: marca, value: "VisionX" }
              - column: { name: precio_unitario, valueNumeric: 259990 }
              - column: { name: image_key, value: "images/monitor_27_2k_1.png" }

        - insert:
            tableName: PRODUCTO
            columns:
              - column: { name: id_producto, valueNumeric: 4 }
              - column: { name: id_categoria, valueNumeric: 4 }
              - column: { name: nombre, value: "Audífonos Inalámbricos ANC" }
              - column: { name: descripcion, value: "Audífonos con cancelación activa de ruido" }
              - column: { name: marca, value: "SoundBeat" }
              - column: { name: precio_unitario, valueNumeric: 59990 }
              - column: { name: image_key, value: "images/audifonos_anc_1.png" }

        # ========= INVENTARIO =========
        - insert:
            tableName: INVENTARIO
            columns:
              - column: { name: id_producto, valueNumeric: 1 }
              - column: { name: cantidad_stock, valueNumeric: 50 }

        - insert:
            tableName: INVENTARIO
            columns:
              - column: { name: id_producto, valueNumeric: 2 }
              - column: { name: cantidad_stock, valueNumeric: 30 }

        - insert:
            tableName: INVENTARIO
            columns:
              - column: { name: id_producto, valueNumeric: 3 }
              - column: { name: cantidad_stock, valueNumeric: 10 }

        - insert:
            tableName: INVENTARIO
            columns:
              - column: { name: id_producto, valueNumeric: 4 }
              - column: { name: cantidad_stock, valueNumeric: 100 }

        # ========= CARRITOS =========
        - insert:
            tableName: CARRITO
            columns:
              - column: { name: id_carrito, valueNumeric: 1 }
              - column: { name: id_cliente, valueNumeric: 1 }
              - column: { name: id_estado_carrito, valueNumeric: 1 } # ACTIVO
              - column: { name: fecha_creacion, valueDate: "2025-02-01T10:00:00Z" }
              - column: { name: total, valueNumeric: 0 }

        - insert:
            tableName: CARRITO
            columns:
              - column: { name: id_carrito, valueNumeric: 2 }
              - column: { name: id_cliente, valueNumeric: 2 }
              - column: { name: id_estado_carrito, valueNumeric: 3 } # CONVERTIDO
              - column: { name: fecha_creacion, valueDate: "2025-02-02T15:30:00Z" }
              - column: { name: total, valueNumeric: 0 }

        # ========= DETALLE_CARRITO =========
        - insert:
            tableName: DETALLE_CARRITO
            columns:
              - column: { name: id_detalle_carrito, valueNumeric: 1 }
              - column: { name: id_carrito, valueNumeric: 1 }
              - column: { name: id_producto, valueNumeric: 1 }
              - column: { name: cantidad, valueNumeric: 2 }
              - column: { name: subtotal, valueNumeric: 39980 }

        - insert:
            tableName: DETALLE_CARRITO
            columns:
              - column: { name: id_detalle_carrito, valueNumeric: 2 }
              - column: { name: id_carrito, valueNumeric: 1 }
              - column: { name: id_producto, valueNumeric: 2 }
              - column: { name: cantidad, valueNumeric: 1 }
              - column: { name: subtotal, valueNumeric: 34990 }

        - insert:
            tableName: DETALLE_CARRITO
            columns:
              - column: { name: id_detalle_carrito, valueNumeric: 3 }
              - column: { name: id_carrito, valueNumeric: 2 }
              - column: { name: id_producto, valueNumeric: 3 }
              - column: { name: cantidad, valueNumeric: 1 }
              - column: { name: subtotal, valueNumeric: 259990 }

        # ========= METODO_PAGO / ESTADO_PAGO =========
        - insert:
            tableName: METODO_PAGO
            columns:
              - column: { name: id_metodo_pago, valueNumeric: 1 }
              - column: { name: tipo_metodo_pago, value: "TARJETA_CREDITO" }

        - insert:
            tableName: METODO_PAGO
            columns:
              - column: { name: id_metodo_pago, valueNumeric: 2 }
              - column: { name: tipo_metodo_pago, value: "TRANSFERENCIA" }

        - insert:
            tableName: ESTADO_PAGO
            columns:
              - column: { name: id_estado_pago, valueNumeric: 1 }
              - column: { name: estado_pago, value: "PENDIENTE" }

        - insert:
            tableName: ESTADO_PAGO
            columns:
              - column: { name: id_estado_pago, valueNumeric: 2 }
              - column: { name: estado_pago, value: "APROBADO" }

        - insert:
            tableName: ESTADO_PAGO
            columns:
              - column: { name: id_estado_pago, valueNumeric: 3 }
              - column: { name: estado_pago, value: "RECHAZADO" }

        # ========= ORDEN / PAGO / REINTENTO_PAGO =========
        - insert:
            tableName: ORDEN
            columns:
              - column: { name: id_orden, valueNumeric: 1 }
              - column: { name: id_carrito, valueNumeric: 2 }
              - column: { name: fecha_orden, valueDate: "2025-02-03T11:00:00Z" }
              - column: { name: estado_orden, value: "PAGADA" }

        - insert:
            tableName: PAGO
            columns:
              - column: { name: id_pago, valueNumeric: 1 }
              - column: { name: id_orden, valueNumeric: 1 }
              - column: { name: id_metodo_pago, valueNumeric: 1 }
              - column: { name: id_estado_pago, valueNumeric: 2 }
              - column: { name: monto, valueNumeric: 259990 }
              - column: { name: fecha_pago, valueDate: "2025-02-03T11:05:00Z" }

        - insert:
            tableName: REINTENTO_PAGO
            columns:
              - column: { name: id_reintento, valueNumeric: 1 }
              - column: { name: id_pago, valueNumeric: 1 }
              - column: { name: intento_numero, valueNumeric: 1 }
              - column: { name: estado_reintento, value: "OK" }
              - column: { name: fecha_reintento, valueDate: "2025-02-03T11:05:00Z" }
